# Task: Refactor FlowController with Use Cases

**Goal:** Refactor `src/infrastructure/web/controllers/FlowController.ts` to consistently apply the route -> controller -> use case pattern for all remaining endpoints (`getAll`, `getById`, `update`, `delete`, `execute`).

**Status:** Pending
**Coordinator:** TASK-CMD-20250415-222557
**Assigned To:** typescript-specialist
**Acceptance Criteria:**
*   `FlowController.ts` methods (`getAll`, `getById`, `update`, `delete`, `execute`) are refactored to call corresponding use cases.
*   New use case files (`GetAllFlowsUseCase.ts`, `GetFlowByIdUseCase.ts`, `UpdateFlowUseCase.ts`, `DeleteFlowUseCase.ts`, `ExecuteFlowUseCase.ts`) are created in `src/application/usecases/flow/`.
*   These use cases encapsulate the logic previously handled directly by `FlowService` within the controller methods.
*   The use cases interact with `FlowService` or other necessary services/repositories.
*   `FlowController.ts` correctly imports, injects (using TypeDI), and utilizes the new use cases.
*   The implementation follows the pattern established by `CreateFlowUseCase.ts`.
*   Appropriate DTOs are used for input/output where necessary (e.g., for update, execute).
*   Error handling remains consistent.

**Context Files:**
*   `src/infrastructure/web/controllers/FlowController.ts` (Current state)
*   `src/application/usecases/flow/CreateFlowUseCase.ts` (Reference implementation)
*   `src/application/services/FlowService.ts` (Likely dependency for use cases)
*   `src/application/services/FlowExecutionService.ts` (Potentially relevant for `ExecuteFlowUseCase`)
*   `src/domain/entities/Flow.ts`
*   `src/application/dtos/` (Check for relevant DTOs like UpdateFlowDto, ExecuteFlowDto - create if needed)
*   `src/domain/repositories/FlowRepository.ts` (May be used by FlowService)

**Checklist:**
- [‚è≥] Analyze `FlowController.ts` methods (`getAll`, `getById`, `update`, `delete`, `execute`) and their interaction with `FlowService`.
- [‚è≥] Create `src/application/usecases/flow/GetAllFlowsUseCase.ts`. Implement logic to fetch all flows via `FlowService`.
- [‚è≥] Create `src/application/usecases/flow/GetFlowByIdUseCase.ts`. Implement logic to fetch a flow by ID via `FlowService`.
- [‚è≥] Create `src/application/usecases/flow/UpdateFlowUseCase.ts`. Define necessary DTO (e.g., `UpdateFlowDto`), implement logic to update a flow via `FlowService`.
- [‚è≥] Create `src/application/usecases/flow/DeleteFlowUseCase.ts`. Implement logic to delete a flow by ID via `FlowService`.
- [‚è≥] Create `src/application/usecases/flow/ExecuteFlowUseCase.ts`. Define necessary DTO (e.g., `ExecuteFlowDto`), implement logic to execute a flow via `FlowService` or `FlowExecutionService`.
- [‚è≥] Update `FlowController.ts`:
    - [‚è≥] Import all new use cases.
    - [‚è≥] Inject new use cases via the constructor (using TypeDI).
    - [‚è≥] Modify `getAll` method to call `GetAllFlowsUseCase.execute()`.
    - [‚è≥] Modify `getById` method to call `GetFlowByIdUseCase.execute()`.
    - [‚è≥] Modify `update` method to use `UpdateFlowDto` (if created), validate, and call `UpdateFlowUseCase.execute()`.
    - [‚è≥] Modify `delete` method to call `DeleteFlowUseCase.execute()`.
    - [‚è≥] Modify `execute` method to use `ExecuteFlowDto` (if created), validate, and call `ExecuteFlowUseCase.execute()`.
    - [‚è≥] Remove direct `FlowService` dependency if no longer needed for these methods.
- [‚è≥] Ensure consistent error handling in controller methods, catching errors from use cases.
- [‚è≥] Verify imports and dependencies are correct.
- [üì£] Report completion or any issues encountered.

---

## Progress Log
- **[2025-04-15 22:38]** Created DTOs: `UpdateFlowDto.ts`, `ExecuteFlowDto.ts`.

- **[2025-04-15 22:38]** Created Use Cases: `GetAllFlowsUseCase.ts`, `GetFlowByIdUseCase.ts`, `UpdateFlowUseCase.ts`, `DeleteFlowUseCase.ts`, `ExecuteFlowUseCase.ts` (including fix for `FlowExecutionService` method).
- **[2025-04-15 22:39]** Verified compilation success via `npm run build` (tsc).
- **[2025-04-15 22:29]** Task initiated. Analyzing requirements and existing code.

---

**Status:** ‚úÖ Complete
**Outcome:** Success - FlowController Refactored with Use Cases
**Summary:** Refactored `FlowController` to use the use case pattern for `getAll`, `getById`, `update`, `delete`, and `execute` methods. Created corresponding use cases (`GetAllFlowsUseCase`, `GetFlowByIdUseCase`, `UpdateFlowUseCase`, `DeleteFlowUseCase`, `ExecuteFlowUseCase`) and necessary DTOs (`UpdateFlowDto`, `ExecuteFlowDto`). The controller now delegates logic to these use cases, improving separation of concerns and adhering to the established pattern.
**References:** [
  `src/infrastructure/web/controllers/FlowController.ts` (modified),
  `src/application/usecases/flow/GetAllFlowsUseCase.ts` (created),
  `src/application/usecases/flow/GetFlowByIdUseCase.ts` (created),
  `src/application/usecases/flow/UpdateFlowUseCase.ts` (created),
  `src/application/usecases/flow/DeleteFlowUseCase.ts` (created),
  `src/application/usecases/flow/ExecuteFlowUseCase.ts` (created/modified),
  `src/application/dtos/UpdateFlowDto.ts` (created),
  `src/application/dtos/ExecuteFlowDto.ts` (created)
]
- **[2025-04-15 22:38]** Refactored `FlowController.ts` to inject and use the new use cases for `getAll`, `getById`, `update`, `delete`, `execute` methods. Added DTO validation for `update` and `execute`. Fixed ESLint indentation issues.